@model IEnumerable<QLDP_02.Models.getPhieuNhapHang_Result>

@{
    ViewBag.Title = "Đơn mua hàng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<header class="page-header page-header-compact page-header-light border-bottom bg-white mb-4">
    <div class="container-fluid px-4">
        <div class="page-header-content">
            <div class="row align-items-center justify-content-between pt-3">
                <div class="col-auto mb-3">
                    <h1 class="page-header-title">
                        <i class="fa-solid fa-warehouse fa-lg"></i>&nbsp;Đơn mua hàng
                    </h1>
                </div>
                <div class="col-12 col-xl-auto mb-3">
                    <button type="button" class="btn btn-light btn-outline-success" onclick="themMoiPhieuNhapHang()">
                        <i class="me-1 fa-regular fa-square-plus"></i>
                        Thêm mới
                    </button>
                    <button type="button" class="btn btn-outline-danger" onclick="xoaPhieuNhapHang()">
                        <i class="me-1 fa-regular fa-trash-can"></i>
                        Xóa
                    </button>
                </div>
            </div>
        </div>
    </div>
</header>


<!-- Main page content-->
<div class="container-fluid px-4">
    <div class="card">
        <div class="card-header">Dữ liệu Đơn mua hàng</div>
        <div class="card-body">
            <table id="tablePhieuNhapHang" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="toggleCheckDonMua(this)"/></th>
                        <th>STT</th>
                        <th>Mã phiếu</th>
                        <th>Tên phiếu</th>
                        <th>Ngày đặt hàng</th>
                        <th>Tên người đặt hàng</th>
                        <th>Nhà cung cấp</th>
                        <th>Tổng SL mua</th>
                        <th>Tổng SL nhập</th>
                        <th>Tổng Thanh toán</th>
                        <th>Hoàn thành</th>
                        <th>Ghi chú<th/>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal ThemMoiPhieuNhapHang -->
<div class="modal fade" id="modalThemMoiPhieuNhapHang" data-dismiss="modal" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticThemMoiPhieuNhapHang" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen" role="document">
        <div class="modal-content">
            <div class="modal-header alert alert-success">
                <h5 class="modal-title" id="staticThemMoiPhieuNhapHang">Thêm mới Phiếu nhập hàng</h5>
                <div class="">
                    <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal"><i class="fa-solid fa-arrow-left me-1"></i>Quay lại</button>
                    <button class="btn btn-outline-success" id="btnCapNhat"><i class="fa-regular fa-floppy-disk me-1"></i>Cập nhật</button>
                </div>
            </div>
            <div class="modal-body">
                <form id="formThemMoiPhieuNhapHang" class="row g-3 needs-validation" novalidate>
                    <div class="form-group row mb-2">
                        <div class="col-lg-2">
                            <label for="id_MaPhieuNhapHang" class="fw-500 required">Mã phiếu <span class="text-danger">(*)</span>:</label>
                            <input type="text" disabled value="" class="form-control" required id="id_MaPhieuNhapHang" />
                            <input value="0" id="MaPhieuNhapHang"/>
                            <div class="invalid-feedback">Vui lòng nhập Mã phiếu.</div>
                        </div>
                        <div class="col-lg-3">
                            <label for="id_TenPhieuNhapHang" class="fw-500 required">Tên Đơn mua hàng <span class="text-danger">(*)</span>:</label>
                            <input type="text" class="form-control" required id="id_TenPhieuNhapHang" />
                            <div class="invalid-feedback">Vui lòng nhập Tên Đơn mua hàng.</div>
                        </div>
                        <div class="col-lg-3">
                            <label for="id_NgayDatHang" class="fw-500 required">Ngày đặt hàng <span class="text-danger">(*)</span>:</label>
                            <input type="datetime-local" class="form-control" required id="id_NgayDatHang" />
                            <div class="invalid-feedback">Vui lòng chọn Ngày đặt hàng.</div>
                        </div>
                        <div class="col-lg-2">
                            <label for="id_NhaCungCap" class="fw-500 required">Nhà cung cấp <span class="text-danger">(*)</span>:</label>
                            @Html.DropDownList("NhaCungCap", null, new { @id = "id_NhaCungCap", @class = "form-select" })
                       
                            <div class="invalid-feedback">Vui lòng chọn Nhà cung cấp.</div>
                        </div>
                        <div class="col-lg-2">
                            <label for="id_KhoNhan" class="fw-500 required">Kho nhận <span class="text-danger">(*)</span>:</label>
                            @Html.DropDownList("KhoNhan", null, new { @id = "id_KhoNhan", @class = "form-control" })
                            <div class="invalid-feedback">Vui lòng chọn Kho nhận.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <div class="col-md-2">
                            <label class="fw-500 required">Tổng SL đã nhập:</label>
                            <input type="number" class="form-control" disabled id="id_TongSLDaNhap" />
                        </div>
                        <div class="col-lg-10">
                            <label class="fw-500 required">Ghi chú:</label>
                            <textarea rows="1" type="text" class="form-control" id="id_GhiChu"></textarea>
                        </div>
                    </div>
                    <hr />

                    <div class="modal-header alert alert-dark align-items-center my-0">
                        <h5 class="modal-title" id="iFormLabel">Danh sách sản phẩm</h5>
                        <div>
                            <button class="btn btn-outline-success" type="button" id="btnThemSanPham" onclick="checkDataThemMoiPhieuNhapHangChiTiet()"><i class="fa-solid fa-plus me-1"></i>Thêm sản phẩm</button>
                            <button class="btn btn-outline-danger" type="button" id="xoaSanPham" onclick="XoaSanPham()"><i class="fa-regular fa-trash-can me-1"></i>xóa</button>
                        </div>
                    </div>
                    <div class="modal-body p-2 pt-0">
                        <table class="table " id="dataTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" onclick="toggleCheckAll(this)" id="checkAllInDataTable"/></th>
                                    <th>Stt</th>
                                    <th>@Html.DisplayName("Sản phẩm")</th>
                                    <th>@Html.DisplayName("Tính chất")</th>
                                    <th>@Html.DisplayName("Size")</th>
                                    <th>@Html.DisplayName("Số lượng")</th>
                                    <th>@Html.DisplayName("Đơn giá")</th>
                                    <th>@Html.DisplayName("Thành tiền")</th>
                                    <th>@Html.DisplayName("SL đã nhập")</th>
                                    <th>@Html.DisplayName("SL còn lại")</th>
                                    <th>@Html.DisplayName("Đơn vị tính")</th>
                                    <th>@Html.DisplayName("Ghi chú (Nếu có)")</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- dữ liệu lấy trong function themMoiPhieuNhapHang() -->
                            </tbody>
                        </table>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal ThemMoiPhieuNhapHangChiTiet -->
<div class="modal fade " id="modalThemMoiPhieuNhapHangChiTiet" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticThemMoiPhieuNhapHangChiTiet" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticThemMoiPhieuNhapHangChiTiet">Chọn sản phẩm</h5>
                <div>
                    <button type="button" id="btn-hide-chonsp" class="btn btn-outline-secondary"><i class="fa-solid fa-arrow-left-long me-2"></i>Back</button>
                    <button type="button" class="btn btn-outline-success" onclick="chonSpPhieuNhap()" id="chonSpPhieuNhap">Save<i class="fa-regular fa-paper-plane ms-1"></i></button>
                </div>
            </div>

            <div class="modal-body pb-0">
                <table id="tableChonSanPham" class="table table-striped">
                    <thead>
                        <tr>
                            <td></td>
                            <td>STT</td>
                            <td>Sản phẩm</td>
                            <td>Tính chất</td>
                            <td>Size</td>
                            <td>Số lượng</td>
                            <td>Đơn giá</td>
                            <td>Đơn vị tính</td>
                            <td>nhà cung cấp</td>
                        </tr>
                    </thead>
                    <tbody id="table-body-chon-sp">
                        
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<!-- Modal SuaPhieuNhapHang -->
<div class="modal fade" id="modalSuaPhieuNhapHang" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticSuaPhieuNhapHang" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen" role="document">
        <div class="modal-content">
            <div class="modal-header alert alert-success">
                <h5 class="modal-title" id="staticSuaPhieuNhapHang">Cập nhật Đơn nhập hàng</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="row g-3 needs-validation" novalidate>
                    <div class="form-group row mb-2">
                        <div class="col-lg-2">
                            <label for="id_SuaMaPhieuNhapHang" class="fw-500 required">Mã phiếu <span class="text-danger">(*)</span>:</label>
                            <input type="text" class="form-control" required id="id_SuaMaPhieuNhapHang" />
                            <div class="invalid-feedback">Vui lòng nhập Mã phiếu.</div>
                        </div>
                        <div class="col-lg-3">
                            <label for="id_SuaTenPhieuNhapHang" class="fw-500 required">Tên Đơn mua hàng <span class="text-danger">(*)</span>:</label>
                            <input type="text" class="form-control" required id="id_SuaTenPhieuNhapHang" />
                            <div class="invalid-feedback">Vui lòng nhập Tên Đơn mua hàng.</div>
                        </div>
                        <div class="col-lg-3">
                            <label for="id_SuaNgayDatHang" class="fw-500 required">Ngày đặt hàng <span class="text-danger">(*)</span>:</label>
                            <input type="datetime-local" class="form-control" required id="id_SuaNgayDatHang" />
                            <div class="invalid-feedback">Vui lòng chọn Ngày đặt hàng.</div>
                        </div>
                        <div class="col-lg-2">
                            <label for="id_SuaNhaCungCap" class="fw-500 required">Nhà cung cấp <span class="text-danger">(*)</span>:</label>
                            @Html.DropDownList("NhaCungCap", null, new { @id = "id_SuaNhaCungCap", @class = "form-control" })
                            <div class="invalid-feedback">Vui lòng chọn Nhà cung cấp.</div>
                        </div>
                        <div class="col-lg-2">
                            <label for="id_SuaKhoNhan" class="fw-500 required">Kho nhận <span class="text-danger">(*)</span>:</label>
                            @Html.DropDownList("KhoNhan", null, new { @id = "id_SuaKhoNhan", @class = "form-control" })
                            <div class="invalid-feedback">Vui lòng chọn Kho nhận.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <div class="col-md-2">
                            <label class="fw-500 required">Tổng SL đã nhập:</label>
                            <input type="number" class="form-control" disabled id="id_SuaTongSLDaNhap" />
                        </div>
                        <div class="col-lg-10">
                            <label class="fw-500 required">Ghi chú:</label>
                            <textarea rows="1" type="text" class="form-control" id="id_SuaGhiChu"></textarea>
                        </div>
                    </div>
                    <hr />

                    <div class="modal-header alert alert-secondary align-items-center my-0">
                        <h5 class="modal-title" id="iFormLabel">Danh sách sản phẩm</h5>
                        <button type="button" class="btn btn-success btn-sm col-md-auto" onclick="checkSuaDataThemMoiPhieuNhapHangChiTiet()">Thêm sản phẩm</button>
                    </div>
                    <div class="modal-body p-2 pt-0">
                        <table class="table table-bordered" id="suaDataTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th> @Html.DisplayName("Sản phẩm") </th>
                                    <th> @Html.DisplayName("Tính chất") </th>
                                    <th> @Html.DisplayName("Size") </th>
                                    <th> @Html.DisplayName("Số lượng") </th>
                                    <th> @Html.DisplayName("Đơn giá") </th>
                                    <th> @Html.DisplayName("Thành tiền") </th>
                                    <th> @Html.DisplayName("SL đã nhập") </th>
                                    <th> @Html.DisplayName("SL còn lại") </th>
                                    <th> @Html.DisplayName("Đơn vị tính") </th>
                                    <th> @Html.DisplayName("Ghi chú (Nếu có)") </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- dữ liệu lấy trong function suaPhieuNhapHang() -->
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer pb-0 mt-0">
                        <button id="id_XacNhanSuaPhieuNhapHang" class="btn btn-success" type="button" onclick="xacNhanSuaPhieuNhapHang()">Xác nhận</button>
                        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Quay lại</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    function hidemodalSuaPhieuNhapHangChiTiet() {
        $('#modalSuaPhieuNhapHangChiTiet').modal('hide');
    }
</script>
<!-- Modal SuaPhieuNhapHangChiTiet -->
<div class="modal fade" id="modalSuaPhieuNhapHangChiTiet" tabindex="-1" role="dialog" aria-labelledby="staticSuaPhieuNhapHangChiTiet" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticSuaPhieuNhapHangChiTiet">Cập nhật sản phẩm</h5>
                <button type="button"  class="btn-close" onclick="hidemodalSuaPhieuNhapHangChiTiet()"></button>
            </div>

            <div class="modal-body pb-0">
                <form class="row g-3 needs-validation my-2" novalidate>
                    <div class="form-group row mb-2">
                        <label for="id_SuaSanPham" class="col-lg-4 d-flex align-items-center">Sản phẩm&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("TenSanPham", null, new { @id = "id_SuaSanPham", @class = "form-control", @required = "required" })
                            <div class="invalid-feedback">Vui lòng Chọn sản phẩm.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_SuaTinhChat" class="col-lg-4 col-lg-3 d-flex align-items-center">Tính chất:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("TinhChatDongPhuc", null, new { @id = "id_SuaTinhChat", @class = "form-control" })
                            <div class="invalid-feedback">Vui lòng Chọn tính chất.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_SuaSize" class="col-lg-4 col-lg-3 d-flex align-items-center">Size:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("Size", null, new { @id = "id_SuaSize", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_SuaSoLuong" class="col-lg-4 col-lg-3 d-flex align-items-center">Số lượng&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            <input type="number" required class="form-control col-lg-8" id="id_SuaSoLuong" />
                            <div class="invalid-feedback">Vui lòng Nhập số lượng.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_SuaDonGia" class="col-lg-4 col-lg-3 d-flex align-items-center">Đơn giá&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            <input type="number" required class="form-control col-lg-8" id="id_SuaDonGia" />
                            <div class="invalid-feedback">Vui lòng Nhập đơn giá.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_SuaDonViTinh" class="col-lg-4 col-lg-3 d-flex align-items-center">Đơn vị tính&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("DonViTinh", null, new { @id = "id_SuaDonViTinh", @class = "form-control", @required = "required" })
                            <div class="invalid-feedback">Vui lòng Chọn đơn vị tính.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_SuaGhiChu" class="col-lg-4 col-lg-3 d-flex align-items-center">Ghi chú:</label>
                        <div class="col-lg-8">
                            <input type="text" class="form-control col-lg-8" id="id_SuaGhiChu" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="xacNhanSuaPhieuNhapHangChiTiet()">Xác nhận</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<!-- Modal ThemMoiSuaPhieuNhapHangChiTiet -->
<div class="modal fade" id="modalThemMoiSuaPhieuNhapHangChiTiet" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticThemMoiSuaPhieuNhapHangChiTiet" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" >Chọn sản phẩm</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body pb-0">
                <form class="row g-3 needs-validation my-2" novalidate>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaSanPham" class="col-lg-4 d-flex align-items-center">Sản phẩm&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("TenSanPham", null, new { @id = "id_ThemSuaSanPham", @class = "form-control", @required = "required" })
                            <div class="invalid-feedback">Vui lòng Chọn sản phẩm.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaTinhChat" class="col-lg-4 col-lg-3 d-flex align-items-center">Tính chất:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("TinhChatDongPhuc", null, new { @id = "id_ThemSuaTinhChat", @class = "form-control" })
                            <div class="invalid-feedback">Vui lòng Chọn tính chất.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaSize" class="col-lg-4 col-lg-3 d-flex align-items-center">Size:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("Size", null, new { @id = "id_ThemSuaSize", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaSoLuong" class="col-lg-4 col-lg-3 d-flex align-items-center">Số lượng&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            <input type="number" required class="form-control col-lg-8" id="id_ThemSuaSoLuong" />
                            <div class="invalid-feedback">Vui lòng Nhập số lượng.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaDonGia" class="col-lg-4 col-lg-3 d-flex align-items-center">Đơn giá&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            <input type="number" required class="form-control col-lg-8" id="id_ThemSuaDonGia" />
                            <div class="invalid-feedback">Vui lòng Nhập đơn giá.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaDonViTinh" class="col-lg-4 col-lg-3 d-flex align-items-center">Đơn vị tính&nbsp;<span class="text-danger">(*)</span>:</label>
                        <div class="col-lg-8">
                            @Html.DropDownList("DonViTinh", null, new { @id = "id_ThemSuaDonViTinh", @class = "form-control", @required = "required" })
                            <div class="invalid-feedback">Vui lòng Chọn đơn vị tính.</div>
                        </div>
                    </div>
                    <div class="form-group row mb-2">
                        <label for="id_ThemSuaGhiChu" class="col-lg-4 col-lg-3 d-flex align-items-center">Ghi chú:</label>
                        <div class="col-lg-8">
                            <input type="text" class="form-control col-lg-8" id="id_ThemSuaGhiChu" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="themMoiSuaPhieuNhapHangChiTiet()">Xác nhận</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<!-- Modal XoaPhieuNhapHang -->
<div class="modal fade" id="modalXoaPhieuNhapHang" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticXoaPhieuNhapHang" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticXoaPhieuNhapHang">Xoá Phiếu nhập hàng</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa-solid fa-triangle-exclamation fa-beat fa-4x"></i>
                    <br />
                    <p class="fw-bolder">Cảnh báo</p>
                    <p>Bạn có chắc Xóa phiếu nhập hàng: <span id="id_XoaPhieuNhapHang" class="text-danger fw-bolder"></span> không?</p>
                </div>

                <div class="modal-footer justify-content-center">
                    <button class="btn btn-danger" type="button" onclick="xacNhanXoaPhieuNhapHang()">Xoá</button>
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Quay lại</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal XoaPhieuNhapHangChiTiet -->
<div class="modal fade" id="modalXoaPhieuNhapHangChiTiet" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticXoaPhieuNhapHangChiTiet" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticXoaPhieuNhapHangChiTiet">Xoá Sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-toggle="modal" data-bs-target="#modalSuaPhieuNhapHang"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa-solid fa-triangle-exclamation fa-beat fa-4x"></i>
                    <br />
                    <p class="fw-bolder">Cảnh báo</p>
                    <p>Bạn có chắc Xóa sản phẩm: <span id="id_XoaPhieuNhapHangChiTiet" class="text-danger fw-bolder"></span> không?</p>
                </div>

                <div class="modal-footer justify-content-center">
                    <button class="btn btn-danger" type="button" onclick="xacNhanXoaPhieuNhapHangChiTiet()">Xoá</button>
                    <button class="btn btn-secondary" type="button" data-bs-toggle="modal" data-bs-target="#modalSuaPhieuNhapHang">Quay lại</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const toggleCheckAll = (element) => {
        const checkboxes = document.querySelectorAll('#dataTable tbody tr input[type="checkbox"]');
        checkboxes.forEach(function (checkbox) {
            console.log(checkbox)
            checkbox.checked = element.checked;
        });
    }
    const toggleCheckDonMua = (element) => {
        const checkboxes = document.querySelectorAll('#tablePhieuNhapHang tbody tr .chonXoa');
        checkboxes.forEach(checkbox => {
            checkbox.checked = element.checked;
            console.log(checkbox)
        });
    };
    function convertDateString(dateString) {
        const timestamp = parseInt(dateString.replace(/\/Date\((-?\d+)\)\//, '$1'));
        const date = new Date(timestamp);

        // Format the date and time
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        const milliseconds = String(date.getMilliseconds()).padStart(3, '0');

        // Construct the input date/time string
        let inputDateTimeString = `${year}-${month}-${day}T${hours}:${minutes}`;
        if (seconds !== '00' || milliseconds !== '000') {
            inputDateTimeString += `:${seconds}`;
            if (milliseconds !== '000') {
                inputDateTimeString += `.${milliseconds}`;
            }
        }

        return inputDateTimeString;
    }
    const renderTableDonMuaHang= ()=> {
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/renderTableDonMuaHang",
            type: "post",
            success: function (response) {
                console.log(response)
                let content = ``
                if (response.success) {
                    response.item.forEach((item) => {
                    content +=`
                    <tr ondblclick="clickSelectDonMuaHang(${item.PhieuNhapHang})">
                        <td><input type="checkbox" class="chonXoa" value=${item.PhieuNhapHang}></td>
                        <td>${item.stt}</td>
                        <td>${item.MaPhieuNhapHang}</td>
                        <td>${item.TenPhieuNhapHang}</td>
                        <td>${convertDateString(item.NgayDatHang)}</td>
                        <td>${item.Hoten}</td>
                        <td>${item.TenNhaCungCap}</td>
                        <td>${item.TongSLMua}</td>
                        <td>${item.TongSLDaNhap}</td>
                        <td>${item.TongThanhToan}</td>
                        <td>
                            <input type="checkbox" id="checkIsHoanThanh" ${item.IsHoanThanh== true ? "checked" : ""} />
                        </td>
                        <td>${item.GhiChu}</td>
                    </tr>`
                    })
                }
                $('#tablePhieuNhapHang tbody').empty()
                $('#tablePhieuNhapHang tbody').append(content)
            }
        })
    }
    renderTableDonMuaHang()

    const clickSelectDonMuaHang = (id) => {
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/SelectDonMuaHang",
            type: "post",
            data: {
                DonMuaHang:+id
            },
            success: function (response) {
                console.log(response)
                if (response.success) {
                    if (response.item.IsHoanThanh === true) {
                        $("#btnCapNhat").hide()
                        $("#btnThemSanPham").hide()
                        $("#xoaSanPham").hide()
                    }
                    if (response.item.IsHoanThanh === false) {
                        $("#btnCapNhat").show()
                        $("#btnThemSanPham").show()
                        $("#xoaSanPham").show()
                    }   
                    $('#id_MaPhieuNhapHang').val(response.item.MaPhieuNhapHang)
                    $('#id_TenPhieuNhapHang').val(response.item.TenPhieuNhapHang)
                    $('#id_NgayDatHang').val(convertDateString(response.item.NgayDatHang))
                    $('#id_NhaCungCap').val(response.item.NhaCungCap)
                    $('#id_KhoNhan').val(response.item.KhoNhan)
                    $('#id_TongSLDaNhap').val(response.item.TongSLDaNhap)
                    $('#id_GhiChu').val(response.item.GhiChu)
                    $('#MaPhieuNhapHang').val(response.item.PhieuNhapHang)
                    $('#id_NhaCungCap').prop('disabled', true);

                    //ds
                    let content = ''
                    response.dsSanPham.forEach((item) => {
                        //console.log(item)
                        content += `
                        <tr>
                            <td><input type="checkbox" value=${item.ID}></td>
                            <td>${item.stt}</td>
                            <td>${item.TenSanPham}</td>
                            <td>${item.TenTinhChatDongPhuc || ""}</td>
                            <td>${item.MaSize}</td>
                            <td>${item.SoLuong}</td>
                            <td>${item.DonGia}</td>
                            <td>${item.ThanhTien}</td>
                            <td>${item.SoLuongDaNhap}</td>
                            <td>${item.SLConLai}</td>
                            <td>${item.TenDonViTinh}</td>
                            <td>${item.GhiChu}</td>
                        </tr>
                        `
                    })    

                    $('#dataTable tbody').empty()
                    $('#dataTable tbody').append(content)
                }
            }
        })
        $("#modalThemMoiPhieuNhapHang").modal('show')
    }
    const XoaSanPham = () => {
        let checkboxes = document.querySelectorAll('#dataTable tbody tr input[type="checkbox"]');
        let selectedRows = [];
        checkboxes.forEach(function (checkbox) {
            if (checkbox.checked) {
                //let row = checkbox.closest('tr');
                //selectedRows.push(row);
                const data = {
                    ID: +checkbox.value
                }
                selectedRows.push(data)
            }
        })
        if (selectedRows.length == 0) {
            Toast.fire({
                icon: "question",
                title: "Chưa chọn sản phẩm"
            })
            return
        }
        console.log(selectedRows)
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/PhieuNhap_XoaSanPham",
            type: "post",
            data: {
                PhieuNhapHang :+$("#MaPhieuNhapHang").val(),
                danhSachXoa:selectedRows
            },
            success: function (response) {
                Toast.fire({
                    icon: "success",
                    title: "Delete successfull"
                })
                clickSelectDonMuaHang($("#MaPhieuNhapHang").val())
                renderTableDonMuaHang()
            }
        })
    }
    function randomMaPhieu(length) {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        const charactersLength = characters.length;
        for (let i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return 'NH_' + result;
    }
    console.log(randomMaPhieu(5))
    function padTo2Digits(num) {
        return num.toString().padStart(2, '0');
    }

    // Function to format the current date and time for input type="datetime-local"
    function getCurrentDateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = padTo2Digits(now.getMonth() + 1); // Months are zero-based
        const day = padTo2Digits(now.getDate());
        const hours = padTo2Digits(now.getHours());
        const minutes = padTo2Digits(now.getMinutes());

        return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    // Set the current date and time to the input field
    //$('#id_NgayDatHang').val() = getCurrentDateTime();
    // Script themMoiPhieuNhapHang
    $("#btn-hide-chonsp").on('click', function () {
        $('#modalThemMoiPhieuNhapHangChiTiet').modal('hide');

    })
    function formatCurrencyVND(amount) {
        return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
    }
    $('#id_NgayDatHang').val(getCurrentDateTime())
    //$('#id_MaPhieuNhapHang').val(randomMaPhieu(5))
    function themMoiPhieuNhapHang() {
        $('#id_MaPhieuNhapHang').val("")
        $('#id_TenPhieuNhapHang').val("")
        $('#id_NgayDatHang').val(getCurrentDateTime())
        $('#id_NhaCungCap').val("")
        $('#id_KhoNhan').val("")
        $('#id_TongSLDaNhap').val("")
        $('#id_GhiChu').val("")
        $('#MaPhieuNhapHang').val("")
        $('#id_NhaCungCap').prop('disabled', false);
        $("#btnThemSanPham").show()
        $("#btnCapNhat").hide()
        $("#xoaSanPham").hide()
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/GetThemMoiPhieuNhapHang",
            type: 'GET',
            success: function (data) {
                // Cập nhật HTML của bảng
                $('#dataTable tbody').empty(); // Xóa nội dung cũ trong tbody
                console.log(data)
                $.each(data, function (index, item) {
                    var newRow =
                        "<tr>" +
                        "<td>" + item.TenSanPham + "</td>" +
                        "<td>" + item.TenTinhChatDongPhuc + "</td>" +
                        "<td>" + item.MaSize + "</td>" +
                        "<td>" + item.SoLuong + "</td>" +
                        "<td>" + item.DonGia + "</td>" +
                        "<td>" + item.ThanhTien + "</td>" +
                        "<td>" + item.SoLuongDaNhap + "</td>" +
                        "<td>" + (item.SoLuong - item.SoLuongDaNhap) + "</td>" +
                        "<td>" + item.TenDonViTinh + "</td>" +
                        "<td>" + item.GhiChuChiTiet + "</td>" +
                        "<td>" +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' data-id-chitiet='" + item.ID + "' onclick='suaPhieuNhapHangChiTiet(this)' >" +
                        "<i class='fa-regular fa-pen-to-square'></i>" +
                        "</button> | " +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' data-id-chitiet='" + item.ID + "' onclick='xoaPhieuNhapHangChiTiet(this)' type='button' data-bs-toggle='modal' data-bs-target='#modalXoaPhieuNhapHangChiTiet'>" +
                        "<i class='fa-regular fa-trash-can'></i>" +
                        "</button>" +
                        "</td>" +
                        "</tr>";

                    $('#dataTable tbody').append(newRow);
                });

                $('#modalThemMoiPhieuNhapHang').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }


    // thêm sản phẩm vào phiếu nhập hàng
    const chonSpPhieuNhap=()=>{
        const tableBody = $('#table-body-chon-sp');
        const checkedRows = [];
        const tableRows = document.querySelectorAll('#tableChonSanPham tbody tr');
        tableRows.forEach((row, index) => {
            // Get the checkbox in the first cell
            const checkbox = row.querySelector('input[type="checkbox"]');
            // Check if the checkbox is checked
            if (checkbox.checked) {
                const rowData = {
                    soLuong: +row.querySelector('input[type="number"]').value,
                    donGia: +row.querySelectorAll('input[type="number"]')[1].value,
                    SanPham: +row.cells[9].textContent,
                    Size: +row.cells[10].textContent,
                    TinhChat: +row.cells[11].textContent,
                    NhaCungCap: +row.cells[12].textContent,
                    DonViTinh: +row.cells[13].textContent,
                }
                checkedRows.push(rowData)
            }

        })
        if (checkedRows.length == 0) {
            Toast.fire({
                icon: "question",
                title: "No product has been selected."
            });
            return;
        }
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/ChonSpPhieuNhap",
            type: 'post',
            data: {
                SelectedRows: checkedRows,
                MaPhieuNhap: $("#id_MaPhieuNhapHang").val(),
                TenPhieuNhap: $("#id_TenPhieuNhapHang").val(),
                GhiChu: $('#id_GhiChu').val(),
                KhoNhan: +$('#id_KhoNhan').val(),
            },
            success: function (response) {
                console.log(response)
                clickSelectDonMuaHang(response.item.PhieuNhapHang)
                if (response.success = true) {
                    Toast.fire({
                        icon: "success",
                        title: "Product added successfully."
                    })
                    renderTableDonMuaHang()
                    $('#modalThemMoiPhieuNhapHangChiTiet').modal('hide')
                }
            }

        })
    }
    const renderDanhSachSanPham = (maPhieuNhap) => {
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/PhieuNhap_GetSanPhamByPhieuNhap",
            type: 'post',
            data: {
                MaPhieu: maPhieuNhap
            },
            success: function (response) {
                console.log(response)
                let content = ``
                response.item.forEach((item) => {
                    content += `<tr>
                            <td></td>
                            <td>${item.TenSanPham}</td>
                            <td>${item.TenTinhChatDongPhuc == null ? "" : item.TenTinhChatDongPhuc}</td>
                            <td>${item.MaSize}</td>
                            <td>${item.SoLuong}</td>
                            <td>${formatCurrencyVND(item.DonGia)}</td>
                            <td>${formatCurrencyVND(item.ThanhTien)}</td>
                            <td>${item.SoLuongDaNhap}</td>
                            <td>${item.SoLuongConLai}</td>
                            <td>${item.TenDonViTinh}</td>
                            <td>${item.GhiChu}</td>
                            <td>
                                <button class='btn btn-datatable btn-icon btn-transparent-dark' data-id-chitiet='${item.ID}' onclick='suaPhieuNhapHangChiTiet(this)' >
                                    <i class='fa-regular fa-pen-to-square'></i>
                                </button> |
                                <button class='btn btn-datatable btn-icon btn-transparent-dark' data-id-chitiet='${item.ID}' onclick='xoaPhieuNhapHangChiTiet(this)' type='button' data-bs-toggle='modal' data-bs-target='#modalXoaPhieuNhapHangChiTiet'>
                                    <i class='fa-regular fa-trash-can'></i>
                                </button>
                            </td>
                        </tr>`
                })
                $('#dataTable tbody').html(content)
            }
        })
    }
    function checkDataThemMoiPhieuNhapHangChiTiet() {
        // Thu thập dữ liệu từ input trong modal
        var MaPhieuNhapHang = $('#id_MaPhieuNhapHang').val();
        var TenPhieuNhapHang = $('#id_TenPhieuNhapHang').val();
        var NgayDatHang = $('#id_NgayDatHang').val();
        var NhaCungCap = $('#id_NhaCungCap').val();
        var KhoNhan = $('#id_KhoNhan').val();

        if (!TenPhieuNhapHang || !NgayDatHang || !NhaCungCap || !KhoNhan) {
            Toast.fire({
                icon: "question",
                title: "Input is null."
            });
            return;
        }
        else {
            console.log(NhaCungCap)
            $.ajax({
                url: '/NS_DP_PhieuNhapHang/NhapHang_GetDanhSachSanPhamChuaChon',
                type: 'POST',
                data: {
                    NhaCungCap: +NhaCungCap
                },
                success: function (response) {
                    console.log(response);
                    let content = ``
                    let stt=1
                    response.item.forEach((item) => {
                       content+= `<tr>
                            <td><input type="checkbox" /></td>
                            <td>${stt}</td>
                            <td>${item.TenSanPham}</td>
                            <td>${item.TenTinhChatDongPhuc == null ? "" : item.TenTinhChatDongPhuc}</td>
                            <td>${item.MaSize}</td>
                            <td><input class="form-control" type="number" onfocusout="checkInput(this,'Quantity')" value="1" /></td>
                            <td><input class="form-control" type="number" onfocusout="checkInput(this,'Price')" value="${item.DonGia}" /></td>
                            <td>${item.TenDonViTinh}</td>
                            <td>${item.TenNhaCungCap}</td>
                            <td style = "display:none">${item.SanPham}</td>
                            <td style = "display:none">${item.Size}</td>
                            <td style = "display:none">${item.TinhChatDongPhuc}</td>
                            <td style = "display:none">${item.NhaCungCap}</td>
                            <td style = "display:none">${item.DonViTinh}</td>
                        </tr>`
                        stt++
                    })
                    $("#tableChonSanPham tbody").html(content)
                },
                error: function (xhr, status, error) {
                    console.log("Error:", error);
                }
            });
            $('#modalThemMoiPhieuNhapHangChiTiet').modal('show');
        }

    }
    function themMoiPhieuNhapHang_CONTINUE() {
        if (IdPhieuNhapHangCurrent == null)
            IdPhieuNhapHangCurrent = IdPhieuNhapHang;
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/GetIdPhieuNhapHang/" + IdPhieuNhapHangCurrent,
            type: 'POST',
            data: {
                PhieuNhapHang: IdPhieuNhapHangCurrent
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data);
                $('#id_SuaMaPhieuNhapHang').val(data.MaPhieuNhapHang);
                $('#id_SuaTenPhieuNhapHang').val(data.TenPhieuNhapHang);

                var NgayDH = parseInt(data.NgayDatHang.replace("/Date(", "").replace(")/", ""), 10);
                var serverDateTime = new Date(NgayDH);
                $('#id_SuaNgayDatHang').val(serverDateTime.toISOString().slice(0, 16));

                $('#id_SuaNhaCungCap').val(data.NhaCungCap);
                $('#id_SuaKhoNhan').val(data.KhoNhan);
                $('#id_SuaGhiChu').val(data.GhiChu);
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });

        $.ajax({
            url: "/NS_DP_PhieuNhapHang/SuaPhieuNhapHang/" + IdPhieuNhapHangCurrent,
            type: 'GET',
            data: {
                PhieuNhapHang: IdPhieuNhapHangCurrent
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data);

                // Cập nhật HTML của bảng
                $('#suaDataTable tbody').empty(); // Xóa nội dung cũ trong tbody

                $.each(data, function (index, item) {
                    var newRow =
                        "<tr>" +
                        "<td>" + ((item.TenSanPham !== null && item.TenSanPham !== undefined) ? item.TenSanPham : "") + "</td>" +
                        "<td>" + (item.TenTinhChatDongPhuc !== null ? item.TenTinhChatDongPhuc : "") + "</td>" +
                        "<td>" + (item.MaSize !== null ? item.MaSize : "") + "</td>" +
                        "<td>" + (item.SoLuong !== null ? item.SoLuong : "") + "</td>" +
                        "<td>" + (item.DonGia !== null ? item.DonGia : "") + "</td>" +
                        "<td>" + (item.ThanhTien !== null ? item.ThanhTien : "") + "</td>" +
                        "<td>" + (item.SoLuongDaNhap !== null ? item.SoLuongDaNhap : "") + "</td>" +
                        "<td>" + ((item.SoLuong !== null && item.SoLuongDaNhap !== null) ? (item.SoLuong - item.SoLuongDaNhap) : "") + "</td>" +
                        "<td>" + (item.TenDonViTinh !== null ? item.TenDonViTinh : "") + "</td>" +
                        "<td>" + (item.GhiChuChiTiet !== null ? item.GhiChuChiTiet : "") + "</td>" +
                        "<td>" +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='suaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-pen-to-square'></i>" +
                        "</button> | " +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='xoaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-trash-can'></i>" +
                        "</button>" +
                        "</td>" +
                        "</tr>";

                    $('#suaDataTable tbody').append(newRow);
                });

                $('#modalSuaPhieuNhapHang').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

    // Script suaPhieuNhapHang
    var IdPhieuNhapHang;
    function suaPhieuNhapHang(button) {
        $("#id_SuaNhaCungCap").prop("disabled", true);
        IdPhieuNhapHang = parseInt(button.getAttribute("data-id"), 10);

        $.ajax({
            url: "/NS_DP_PhieuNhapHang/GetIdPhieuNhapHang/" + IdPhieuNhapHang,
            type: 'POST',
            data: {
                PhieuNhapHang: IdPhieuNhapHang
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data);
                $('#id_SuaMaPhieuNhapHang').val(data.MaPhieuNhapHang);
                $('#id_SuaTenPhieuNhapHang').val(data.TenPhieuNhapHang);
                $("#id_SuaTongSLDaNhap").val(data.TongSLDaNhap)
                $("#id_SuaMaPhieuNhapHang").prop('disabled', true)
                $("#id_SuaTenPhieuNhapHang").prop('disabled', true)
                var NgayDH = parseInt(data.NgayDatHang.replace("/Date(", "").replace(")/", ""), 10);
                var serverDateTime = new Date(NgayDH);
                $('#id_SuaNgayDatHang').val(serverDateTime.toISOString().slice(0, 16));

                $('#id_SuaNhaCungCap').val(data.NhaCungCap);
                $('#id_SuaKhoNhan').val(data.KhoNhan);
                $('#id_SuaGhiChu').val(data.GhiChu);

                $('#modalSuaPhieuNhapHang').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });

        $.ajax({
            url: "/NS_DP_PhieuNhapHang/SuaPhieuNhapHang/" + IdPhieuNhapHang,
            type: 'GET',
            data: {
                PhieuNhapHang: IdPhieuNhapHang
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data);

                // Cập nhật HTML của bảng
                $('#suaDataTable tbody').empty(); // Xóa nội dung cũ trong tbody

                $.each(data, function (index, item) {
                    var newRow =
                        "<tr>" +
                        "<td>" + ((item.TenSanPham !== null && item.TenSanPham !== undefined) ? item.TenSanPham : "") + "</td>" +
                        "<td>" + (item.TenTinhChatDongPhuc !== null ? item.TenTinhChatDongPhuc : "") + "</td>" +
                        "<td>" + (item.MaSize !== null ? item.MaSize : "") + "</td>" +
                        "<td>" + (item.SoLuong !== null ? item.SoLuong : "") + "</td>" +
                        "<td>" + (item.DonGia !== null ? formatCurrencyVND(item.DonGia) : "") + "</td>" +
                        "<td>" + (item.ThanhTien !== null ? formatCurrencyVND(item.ThanhTien) : "") + "</td>" +
                        "<td>" + (item.SoLuongDaNhap !== null ? item.SoLuongDaNhap : "") + "</td>" +
                        "<td>" + ((item.SoLuong !== null && item.SoLuongDaNhap !== null) ? (item.SoLuong - item.SoLuongDaNhap) : "") + "</td>" +
                        "<td>" + (item.TenDonViTinh !== null ? item.TenDonViTinh : "") + "</td>" +
                        "<td>" + (item.GhiChuChiTiet !== null ? item.GhiChuChiTiet : "") + "</td>" +
                        "<td>" +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='suaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-pen-to-square'></i>" +
                        "</button> | " +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='xoaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-trash-can'></i>" +
                        "</button>" +
                        "</td>" +
                        "</tr>";

                    $('#suaDataTable tbody').append(newRow);
                });

                $('#modalSuaPhieuNhapHang').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

    function xacNhanSuaPhieuNhapHang() {
        // Thu thập dữ liệu từ input trong modal
        var MaPhieuNhapHang = $('#id_SuaMaPhieuNhapHang').val();
        var TenPhieuNhapHang = $('#id_SuaTenPhieuNhapHang').val();
        var NgayDatHang = $('#id_SuaNgayDatHang').val();
        var NhaCungCap = $('#id_SuaNhaCungCap').val();
        var KhoNhan = $('#id_SuaKhoNhan').val();
        var GhiChu = $('#id_SuaGhiChu').val();

        if (MaPhieuNhapHang && TenPhieuNhapHang && NgayDatHang && NhaCungCap && KhoNhan) {
            // Sử dụng AJAX để gửi dữ liệu đến controller
            $.ajax({
                url: '/NS_DP_PhieuNhapHang/Edit/' + IdPhieuNhapHang, // Thay đổi đường dẫn tới controller của bạn
                type: 'POST',
                data: {
                    PhieuNhapHang: IdPhieuNhapHang,
                    MaPhieuNhapHang: MaPhieuNhapHang,
                    TenPhieuNhapHang: TenPhieuNhapHang,
                    NgayDatHang: NgayDatHang,
                    NhaCungCap: NhaCungCap,
                    KhoNhan: KhoNhan,
                    GhiChu: GhiChu
                },
                success: function (response) {
                    // Xử lý phản hồi từ controller (nếu cần)
                    console.log(response);

                    // Load lại trang
                    location.reload();
                },
                error: function (error) {
                    console.error('Lỗi khi gửi dữ liệu: ', error);
                }
            });
        }
        else {
            console.error('Lỗi khi gửi dữ liệu: ');
        }
    }

    function checkSuaDataThemMoiPhieuNhapHangChiTiet() {
        var MaPhieuNhapHang = $('#id_SuaMaPhieuNhapHang').val();
        var TenPhieuNhapHang = $('#id_SuaTenPhieuNhapHang').val();
        var NgayDatHang = $('#id_SuaNgayDatHang').val();
        var NhaCungCap = $('#id_SuaNhaCungCap').val();
        var KhoNhan = $('#id_SuaKhoNhan').val();

        if (MaPhieuNhapHang && TenPhieuNhapHang && NgayDatHang && NhaCungCap && KhoNhan) {
            $("#id_ThemSuaTinhChat").val(null);
            $("#id_ThemSuaSize").val(null);

            $('#modalThemMoiSuaPhieuNhapHangChiTiet').modal('show');
        }
        else {
            console.error('Dữ liệu bị thiếu.');
        }
    }

    // Script themMoiSuaPhieuNhapHangChiTiet
    function themMoiSuaPhieuNhapHangChiTiet() {
        // Thu thập dữ liệu từ input trong modal
        var PhieuNhapHang = IdPhieuNhapHang;
        var SanPham = $('#id_ThemSuaSanPham').val();
        var TinhChat = $('#id_ThemSuaTinhChat').val();
        var Size = $('#id_SuaSize').val();
        var SoLuong = parseInt($('#id_ThemSuaSoLuong').val());
        var DonGia = parseFloat($('#id_ThemSuaDonGia').val());
        var DonViTinh = $('#id_ThemSuaDonViTinh').val();
        var GhiChu = $('#id_ThemSuaGhiChu').val();

        if (SanPham && SoLuong && DonGia && DonViTinh) {
            // Sử dụng AJAX để gửi dữ liệu đến controller
            $.ajax({
                url: '/NS_DP_PhieuNhapHang/ThemMoiSuaChiTiet', // Thay đổi đường dẫn tới controller của bạn
                type: 'POST',
                data: {
                    PhieuNhapHang: PhieuNhapHang,
                    SanPham: SanPham,
                    TinhChat: TinhChat,
                    Size: Size,
                    SoLuong: SoLuong,
                    DonGia: DonGia,
                    DonViTinh: DonViTinh,
                    GhiChu: GhiChu
                },
                success: function (data) {
                    // Xử lý phản hồi từ controller (nếu cần)
                    console.log(data);

                    // Đóng modal sau khi lưu thành công
                    $('#modalThemMoiSuaPhieuNhapHangChiTiet').modal('hide');

                    themMoiPhieuNhapHang_CONTINUE();
                },
                error: function (error) {
                    console.error('Lỗi khi gửi dữ liệu: ', error);
                }
            });
        }
        else {
            console.error('Lỗi khi gửi dữ liệu: ', error);
        }
    }

    // Script suaPhieuNhapHangChiTiet
    var IdPhieuNhapHangChiTiet;
    function suaSuaPhieuNhapHangChiTiet(button) {
        IdPhieuNhapHangChiTiet = parseInt(button.getAttribute("data-id-chitiet"), 10);

        $.ajax({
            url: "/NS_DP_PhieuNhapHang/GetIdPhieuNhapHangChiTiet/" + IdPhieuNhapHangChiTiet,
            type: 'POST',
            data: {
                PhieuNhapHangChiTiet: IdPhieuNhapHangChiTiet
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data)

                $("#id_SuaTinhChat").prepend($("<option>", {
                    value: null,
                    text: ""
                }));

                $("#id_SuaSize").prepend($("<option>", {
                    value: null,
                    text: ""
                }));
                $("#id_SuaSanPham").prop("disabled", true);
                $('#id_SuaSanPham').val(data.SanPham);
                $('#id_SuaTinhChat').val(data.TinhChatDongPhuc);
                $('#id_SuaSize').val(data.Size);
                $('#id_SuaSoLuong').val(data.SoLuong);
                $('#id_SuaDonGia').val(data.DonGia);
                $('#id_SuaDonViTinh').val(data.DonViTinh);
                $('#id_SuaGhiChuChiTiet').val(data.GhiChuChiTiet);

                $('#modalSuaPhieuNhapHangChiTiet').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

    function xacNhanSuaPhieuNhapHangChiTiet() {
        // Thu thập dữ liệu từ input trong modal
        var ID = IdPhieuNhapHangChiTiet;
        var SanPham = $('#id_SuaSanPham').val();
        var TinhChat = $('#id_SuaTinhChat').val();
        var Size = $('#id_SuaSize').val();
        var SoLuong = parseInt($('#id_SuaSoLuong').val());
        var DonGia = parseFloat($('#id_SuaDonGia').val());
        var DonViTinh = $('#id_SuaDonViTinh').val();
        var GhiChu = $('#id_SuaGhiChu').val();

        // Sử dụng AJAX để gửi dữ liệu đến controller
        $.ajax({
            url: '/NS_DP_PhieuNhapHang/EditChiTiet', // Thay đổi đường dẫn tới controller của bạn
            type: 'POST',
            data: {
                ID: ID,
                SanPham: SanPham,
                TinhChat: TinhChat,
                Size: Size,
                SoLuong: SoLuong,
                DonGia: DonGia,
                DonViTinh: DonViTinh,
                GhiChu: GhiChu
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data);
                // Đóng modal sau khi lưu thành công
                $('#modalSuaPhieuNhapHangChiTiet').modal('hide');

                // Cập nhật HTML của bảng
                $('#suaDataTable tbody').empty(); // Xóa nội dung cũ trong tbody

                $.each(data, function (index, item) {
                    var newRow =
                        "<tr>" +
                        "<td>" + ((item.TenSanPham !== null && item.TenSanPham !== undefined) ? item.TenSanPham : "") + "</td>" +
                        "<td>" + (item.TenTinhChatDongPhuc !== null ? item.TenTinhChatDongPhuc : "") + "</td>" +
                        "<td>" + (item.MaSize !== null ? item.MaSize : "") + "</td>" +
                        "<td>" + (item.SoLuong !== null ? item.SoLuong : "") + "</td>" +
                        "<td>" + (item.DonGia !== null ? item.DonGia : "") + "</td>" +
                        "<td>" + (item.ThanhTien !== null ? item.ThanhTien : "") + "</td>" +
                        "<td>" + (item.SoLuongDaNhap !== null ? item.SoLuongDaNhap : "") + "</td>" +
                        "<td>" + ((item.SoLuong !== null && item.SoLuongDaNhap !== null) ? (item.SoLuong - item.SoLuongDaNhap) : "") + "</td>" +
                        "<td>" + (item.TenDonViTinh !== null ? item.TenDonViTinh : "") + "</td>" +
                        "<td>" + (item.GhiChuChiTiet !== null ? item.GhiChuChiTiet : "") + "</td>" +
                        "<td>" +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='suaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-pen-to-square'></i>" +
                        "</button> | " +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='xoaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-trash-can'></i>" +
                        "</button>" +
                        "</td>" +
                        "</tr>";

                    $('#suaDataTable tbody').append(newRow);
                });

                $('#modalSuaPhieuNhapHang').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

    function xoaPhieuNhapHang() {
        let checkboxes = document.querySelectorAll('#tablePhieuNhapHang tbody tr .chonXoa');
        let selectedRows = [];
        checkboxes.forEach(function (checkbox) {
            if (checkbox.checked) {
                //let row = checkbox.closest('tr');
                //selectedRows.push(row);
                const data = {
                    PhieuNhapHang: +checkbox.value
                }
                selectedRows.push(data)
            }
        })
        if (selectedRows.length == 0) {
            Toast.fire({
                icon: "question",
                title: "Chưa chọn phiếu nhập"
            })
            return
        }
        console.log(selectedRows)
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/DeletePhieuNhap",
            type: "post",
            data: {
                listPhieu: selectedRows
            },
            success: function (response) {
                if (response.success) {
                    Toast.fire({
                        icon: "success",
                        title: "Delete successfull"
                    })
                    renderTableDonMuaHang()
                }
                if (response.success == false) {
                    Toast.fire({
                        icon: "warning",
                        title: "Không thể xóa vì đơn đã duyệt"
                    })
                }
            }
        })
    }

    function xacNhanXoaPhieuNhapHang() {
        var PhieuNhapHang = IdPhieuNhapHang;

        // Gửi yêu cầu xóa sản phẩm lên server
        $.ajax({
            url: "/NS_DP_PhieuNhapHang/Delete/" + PhieuNhapHang,
            type: "POST",
            data: {
                PhieuNhapHang: PhieuNhapHang
            },
            success: function (response) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(response);
                // Đóng modal sau khi xoá thành công
                $('#modalXoaPhieuNhapHang').modal('hide');
                // Reload trang
                location.reload();
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

    function xoaSuaPhieuNhapHangChiTiet(button) {
        IdPhieuNhapHangChiTiet = parseInt(button.getAttribute("data-id-chitiet"), 10);

        $.ajax({
            url: "/NS_DP_PhieuNhapHang/GetNamePhieuNhapHangChiTiet/" + IdPhieuNhapHangChiTiet,
            type: 'POST',
            data: {
                PhieuNhapHangChiTiet: IdPhieuNhapHangChiTiet
            },
            success: function (data) {
                $('#modalSuaPhieuNhapHang').modal('hide');

                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data)
                $('#id_XoaPhieuNhapHangChiTiet').text(data.TenSanPham);

                $('#modalXoaPhieuNhapHangChiTiet').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

    function xacNhanXoaPhieuNhapHangChiTiet() {
        // Thu thập dữ liệu từ input trong modal
        var ID = IdPhieuNhapHangChiTiet;

        // Sử dụng AJAX để gửi dữ liệu đến controller
        $.ajax({
            url: '/NS_DP_PhieuNhapHang/DeleteChiTiet', // Thay đổi đường dẫn tới controller của bạn
            type: 'POST',
            data: {
                ID: ID
            },
            success: function (data) {
                // Xử lý phản hồi từ controller (nếu cần)
                console.log(data);
                // Đóng modal sau khi lưu thành công
                $('#modalXoaPhieuNhapHangChiTiet').modal('hide');

                // Cập nhật HTML của bảng
                $('#suaDataTable tbody').empty(); // Xóa nội dung cũ trong tbody

                $.each(data, function (index, item) {
                    var newRow =
                        "<tr>" +
                        "<td>" + ((item.TenSanPham !== null && item.TenSanPham !== undefined) ? item.TenSanPham : "") + "</td>" +
                        "<td>" + (item.TenTinhChatDongPhuc !== null ? item.TenTinhChatDongPhuc : "") + "</td>" +
                        "<td>" + (item.MaSize !== null ? item.MaSize : "") + "</td>" +
                        "<td>" + (item.SoLuong !== null ? item.SoLuong : "") + "</td>" +
                        "<td>" + (item.DonGia !== null ? item.DonGia : "") + "</td>" +
                        "<td>" + (item.ThanhTien !== null ? formatCurrencyVND(item.ThanhTien) : "") + "</td>" +
                        "<td>" + (item.SoLuongDaNhap !== null ? item.SoLuongDaNhap : "") + "</td>" +
                        "<td>" + ((item.SoLuong !== null && item.SoLuongDaNhap !== null) ? (item.SoLuong - item.SoLuongDaNhap) : "") + "</td>" +
                        "<td>" + (item.TenDonViTinh !== null ? item.TenDonViTinh : "") + "</td>" +
                        "<td>" + (item.GhiChuChiTiet !== null ? item.GhiChuChiTiet : "") + "</td>" +
                        "<td>" +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='suaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-pen-to-square'></i>" +
                        "</button> | " +
                        "<button class='btn btn-datatable btn-icon btn-transparent-dark' type='button' data-id-chitiet='" + item.ID + "' onclick='xoaSuaPhieuNhapHangChiTiet(this)'>" +
                        "<i class='fa-regular fa-trash-can'></i>" +
                        "</button>" +
                        "</td>" +
                        "</tr>";

                    $('#suaDataTable tbody').append(newRow);
                });

                $('#modalSuaPhieuNhapHang').modal('show');
            },
            error: function (error) {
                console.error('Lỗi khi gửi dữ liệu: ', error);
            }
        });
    }

</script>
